name: ðŸ” Test SSH Connection

on:
  workflow_dispatch:

jobs:
  test-ssh:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ”‘ Setup SSH key
      run: |
        echo "ðŸ” Configurando chave SSH..."
        mkdir -p ~/.ssh
        echo "ðŸ“ Criando arquivo de chave..."
        echo "${{ secrets.SERVLA_SSH_KEY }}" > ~/.ssh/servla_key
        echo "ðŸ” Configurando permissÃµes..."
        chmod 600 ~/.ssh/servla_key
        echo "ðŸ” Verificando arquivo..."
        ls -la ~/.ssh/
        echo "ðŸ“‹ Primeiras linhas da chave:"
        head -3 ~/.ssh/servla_key
        echo "ðŸ”— Adicionando host key..."
        ssh-keyscan -H ${{ secrets.SERVLA_HOST }} >> ~/.ssh/known_hosts
        echo "âœ… Setup SSH concluÃ­do!"
        
    - name: ðŸ§ª Test SSH Connection
      run: |
        echo "ðŸ”— Testando conexÃ£o SSH..."
        ssh -i ~/.ssh/servla_key -p ${{ secrets.SERVLA_PORT }} ${{ secrets.SERVLA_USERNAME }}@${{ secrets.SERVLA_HOST }} "echo 'âœ… ConexÃ£o SSH OK!' && whoami && pwd"
        echo "âœ… Teste concluÃ­do!"
