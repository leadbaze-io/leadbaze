name: ðŸ› Debug SSH Connection

on:
  workflow_dispatch:

jobs:
  debug-ssh:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ”‘ Setup SSH key
      run: |
        echo "ðŸ” Configurando chave SSH..."
        mkdir -p ~/.ssh
        echo "ðŸ“ Criando arquivo de chave..."
        echo "${{ secrets.SERVLA_SSH_KEY }}" > ~/.ssh/servla_key
        echo "ðŸ” Configurando permissÃµes..."
        chmod 600 ~/.ssh/servla_key
        echo "ðŸ” Verificando arquivo..."
        ls -la ~/.ssh/
        echo "ðŸ“‹ ConteÃºdo completo da chave:"
        cat ~/.ssh/servla_key
        echo "ðŸ”— Adicionando host key..."
        ssh-keyscan -H ${{ secrets.SERVLA_HOST }} >> ~/.ssh/known_hosts
        echo "âœ… Setup SSH concluÃ­do!"
        
    - name: ðŸ§ª Test SSH with verbose
      run: |
        echo "ðŸ”— Testando conexÃ£o SSH com verbose..."
        ssh -v -i ~/.ssh/servla_key -p ${{ secrets.SERVLA_PORT }} ${{ secrets.SERVLA_USERNAME }}@${{ secrets.SERVLA_HOST }} "echo 'âœ… ConexÃ£o SSH OK!'"
        echo "âœ… Teste concluÃ­do!"
